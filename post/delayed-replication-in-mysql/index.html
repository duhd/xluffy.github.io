<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Delayed Replication in MySQL | xluffy&#39;s page</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
    <header>

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <nav>
    <ul>
      
      
      <li class="pull-left ">
        <a href="https://xluffy.github.io">/home/xluffy&#39;s page</a>
      </li>
      
      
      <li class="pull-left ">
        <a href="/categories/">~/categories</a>
      </li>
      

      
      
      <li class="pull-right">
        <a href="/index.xml">~/subscribe</a>
      </li>
      

    </ul>
  </nav>
</header>

  </head>

  <body>
    <br/>

<div class="article-meta">
<h1><span class="title">Delayed Replication in MySQL</span></h1>

<h2 class="date">2018/04/24</h2>
<p class="terms">
  
  
  Categories: <a href="/categories/mysql">mysql</a> 
  
  
  
  
</p>
</div>



<main>
<p>Trong b√†i <a href="https://xluffy.github.io/post/intro-mysql-replication">Gi·ªõi thi·ªáu v·ªÅ MySQL Replication</a> m√¨nh c√≥ gi·ªõi thi·ªáu m·ªôt ch·ª©c nƒÉng c·ªßa h·ªá th·ªëng Replication ƒë√≥ l√† <strong>realtime backup</strong>. N·∫øu server master g·∫∑p s·ª± c·ªë nh∆∞ h∆∞ h·ªèng ·ªï c·ª©ng m√† kh√¥ng th·ªÉ ph·ª•c h·ªìi d·ªØ li·ªáu t·ª´ ·ªï c·ª©ng th√¨ c√°c b·∫£n backup offline ƒë·ªãnh k√¨ s·∫Ω c√≥ ƒë·ªô tr·ªÖ d·ªØ li·ªáu. V√≠ d·ª• n·∫øu ta ch·ªâ ch·∫°y offline backup d·ªØ li·ªáu <strong>2 l·∫ßn/ng√†y</strong> th√¨ d·ªØ li·ªáu trong tr∆∞·ªùng h·ª£p x·∫•u nh·∫•t s·∫Ω b·ªã m·∫•t trong v√≤ng 12 ti·∫øng. N·∫øu s·ª≠ d·ª•ng MySQL replication th√¨ vi·ªác m·∫•t d·ªØ li·ªáu s·∫Ω v√¥ c√πng nh·ªè, t·ªëi ƒëa l√† kho·∫£ng v√†i gi√¢y.</p>

<p>Tuy nhi√™n trong vi·ªác v·∫≠n h√†nh h·ªá th·ªëng, lu√¥n c√≥ nh·ªØng r·ªßi ro v·ªÅ con ng∆∞·ªùi kh√¥ng th·ªÉ l∆∞·ªùng tr∆∞·ªõc ƒë∆∞·ª£c nh∆∞ x√≥a nh·∫ßm data, <code>DROP TABLE</code>, <code>DROP DATABASE</code> üôÄ -&gt; üò® -&gt; üôè</p>

<ul>
<li><a href="https://about.gitlab.com/2017/02/10/postmortem-of-database-outage-of-january-31">[Gitlab] - Postmortem of database outage of January 31</a></li>
<li><a href="https://blog.travis-ci.com/2018-04-03-incident-post-mortem">[Travis-CI] - Incident Post-Mortem and Security Advisory: Data Exposure After travis-ci.com Outage</a></li>
</ul>

<p>N·∫øu s·ª≠ d·ª•ng replication th√¨ data b·ªã x√≥a s·∫Ω replicate sang slave ngay l·∫≠p t·ª©c (trong ƒëi·ªÅu ki·ªán l√Ω t∆∞·ªüng ƒë·ªô tr·ªÖ = 0). L√∫c ƒë√≥ s·ª≠ d·ª•ng replication c≈©ng kh√¥ng th·ªÉ <strong>c·ª©u</strong> ƒë∆∞·ª£c nh·ªØng data x√≥a nh·∫ßm.</p>

<p>T·ª´ t√¢m tr·∫°ng c·ªßa ng∆∞·ªùi ƒë√£ <strong>v√†i l·∫ßn</strong> t·ª´ng l√†m <strong>nh·ªØng chuy·ªán t∆∞∆°ng t·ª±</strong>  th√¨ m√¨nh xin kh·∫≥ng ƒë·ªãnh l√† chuy·ªán n√†y ho√†n to√†n &hellip; <a href="https://en.wikipedia.org/wiki/Human_error"><strong>b√¨nh th∆∞·ªùng</strong></a> üôàüôà, l√† con ng∆∞·ªùi th√¨ c≈©ng c√≥ l√∫c m·ªát m·ªèi v√† stress. T·∫•t nhi√™n ·ªü g√≥c ƒë·ªô h·ªá th·ªëng v√† kh√°ch h√†ng th√¨ nh·ªØng h√†nh ƒë·ªông n√†y l√† kh√¥ng ƒë∆∞·ª£c ph√©p x·∫£y ra, v√† d√π x·∫£y ra th√¨ <strong>b·∫±ng m·ªçi gi√°</strong> c≈©ng ph·∫£i ph·ª•c h·ªìi l·∫°i d·ªØ li·ªáu cho kh√°ch h√†ng.</p>

<p>T·ª´ MySQL 5.6 ch√∫ng ta c√≥ th·ªÉ c·∫•u h√¨nh ƒë·ªÉ slave c√≥ ƒë·ªô tr·ªÖ t·ªëi thi·ªÉu n√†o ƒë√≥ so v·ªõi master. C·∫•u h√¨nh c·ª±c k√¨ ƒë∆°n gi·∫£n nh∆∞ng l·ª£i √≠ch th√¨ v√¥ c√πng l·ªõn.</p>

<pre><code>mysql&gt; CHANGE MASTER TO MASTER_DELAY = N;
</code></pre>

<p>V·ªõi N l√† th·ªùi gian t·ªëi thi·ªÉu m√† slave lag so v·ªõi master, v√≠ d·ª•:</p>

<pre><code>mysql&gt; CHANGE MASTER TO MASTER_DELAY = 3660;
</code></pre>

<p>Slave s·∫Ω lu√¥n tr·ªÖ 1 gi·ªù d·ªØ li·ªáu so v·ªõi master, n·∫øu c√≥ b·∫•t k·ª≥ <strong>human error</strong> g√¨ ch√∫ng ta c≈©ng v·∫´n c√≤n c∆° h·ªôi ƒë·ªÉ ph·ª•c h·ªìi l·∫°i data.</p>

<p>Ngo√†i ra, c·∫•u h√¨nh ƒë·ªô tr·ªÖ c·ªßa slave so v·ªõi master c√≤n c√≥ th·ªÉ ·ª©ng d·ª•ng trong vi·ªác test xem chuy·ªán g√¨ s·∫Ω x·∫£y ra khi ƒë·ªô lag tƒÉng d·∫ßn. V√≠ d·ª• khi ·ª©ng d·ª•ng heavy load, ƒë·ªô tr·ªÖ tƒÉng cao th√¨ c√≥ ph√°t sinh bug g√¨ trong h·ªá th·ªëng hay kh√¥ng.</p>

<p>Trong h·ªá th·ªëng production, gi·∫£ ƒë·ªãnh nh·ªØng <strong>t√¨nh hu·ªëng x·∫•u nh·∫•t</strong> lu√¥n l√† vi·ªác c·∫ßn thi·∫øt ƒë·ªÉ ƒë·∫£m b·∫£o gi·∫£m thi·ªÉu t·ªëi ƒëa r·ªßi ro c·ªßa h·ªá th·ªëng. D√π h·ªá th·ªëng c√≥ t·ªët, c√≥ nh·ªØng k·ªπ s∆∞ xu·∫•t s·∫Øc ƒë·∫øn nh∆∞ th·∫ø n√†o c≈©ng lu√¥n c√≥ nh·ªØng t√¨nh hu·ªëng <strong>th·∫≠t kh√¥ng th·ªÉ tin ƒë∆∞·ª£c</strong> nh∆∞ Gitlab, Travis-CI. C·∫©n t·∫Øc v√¥ √°y n√°y, lu√¥n c·∫ßn chu·∫©n b·ªã cho nh·ªØng t√¨nh hu·ªëng nh∆∞ tr√™n.</p>

</main>

    <footer>
      
<script>
(function() {
  function center_el(tagName) {
    var tags = document.getElementsByTagName(tagName), i, tag;
    for (i = 0; i < tags.length; i++) {
      tag = tags[i];
      var parent = tag.parentElement;
      
      if (parent.childNodes.length === 1) {
        
        if (parent.nodeName === 'A') {
          parent = parent.parentElement;
          if (parent.childNodes.length != 1) continue;
        }
        if (parent.nodeName === 'P') parent.style.textAlign = 'center';
      }
    }
  }
  var tagNames = ['img', 'embed', 'object'];
  for (var i = 0; i < tagNames.length; i++) {
    center_el(tagNames[i]);
  }
})();
</script>

      
      <hr/>
      <a href="https://github.com/xluffy">Github</a> | <a href="https://twitter.com/min0lta">Twitter</a> | <a href="https://t.me/xluffy">Telegram</a>
      
      <br><a href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png"></a>
    </footer>
  </body>
</html>

